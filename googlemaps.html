
<!DOCTYPE html>
<html>
  <head>
    <title>Find Nearest Dermatologist</title>
    <style>
      #map {
        height: 90vh;
        width: 100%;
      }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBzYS2k19MZbAaIMnulwaGDelOa0jg7Bac&callback=initMap&libraries=places" async defer></script>

    <script>
      let map;
let center;

if (navigator.geolocation) {
  navigator.geolocation.getCurrentPosition(function (position) {
    var userLocation = {
      lat: position.coords.latitude,
      lng: position.coords.longitude
    };

    // Set the map center to the user's location.
    map.setCenter(userLocation);

    // Add a marker for the user's location.
    var userMarker = new google.maps.Marker({
      position: userLocation, 
      map: map,
      title: 'Your Location'
    });

    // Now, call the function to find and display the nearest dermatologist.
    findPlaces(google.maps.LatLng, google.maps.LatLngBounds, userLocation); // Pass the userLocation variable.
  });
} else {
  alert('Geolocation is not supported by your browser.');
}


async function initMap() {
  const { Map } = await google.maps.importLibrary("maps");
  const { LatLng, LatLngBounds } = await google.maps.importLibrary("core");

  center = new google.maps.LatLng(33.777233, -84.3962967);
  map = new Map(document.getElementById("map"), {
    center: center,
    zoom: 14,
  });
  findPlaces(LatLng, LatLngBounds);
}

async function findPlaces(LatLng, LatLngBounds, userLocation) {
  const { Place } = await google.maps.importLibrary("places");
  //@ts-ignore
  const { AdvancedMarkerElement } = await google.maps.importLibrary("marker");
  const request = {
    query: "Dermatologists in Atlanta",
    fields: [
      "displayName",
      "location",
      "businessStatus",
      "hasWheelchairAccessibleEntrance",
    ],
    language: "en-US",
    maxResultCount: 7,
    minRating: 3.2,
    region: "us",
    useStrictTypeFiltering: false,
  };
  //@ts-ignore
  const { places } = await Place.searchByText(request);
  const bound = new LatLngBounds();

  if (places.length) {
    console.log(places);
    places.forEach((place) => {
      const markerView = new AdvancedMarkerElement({
        map,
        position: place.location,
        title: place.displayName,
      });

      bound.extend(new LatLng(place.location));
      console.log(place);
    });
    map.setCenter(bound.getCenter());
  } else {
    console.log("No results");
  }
}

initMap();
  </script>
  </head>
  <body>
    <h1>Find Nearest Dermatologist</h1>
    <div id="map"></div>
  </body>
</html>


